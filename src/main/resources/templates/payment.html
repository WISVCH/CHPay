<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <title>Payment</title>
</head>
<body>
    <div layout:fragment="main-content">
        <div class="container max-w-2xl mx-auto py-8">
            <!-- Payment Card -->
            <div class="card bg-base-100 shadow-lg border border-base-content/10 hover:shadow-xl transition-shadow">
                <div class="card-body text-center p-8">
                    <!-- Price at the top -->
                    <div class="stat-value text-primary text-6xl mb-8 mt-4">
                        €<span th:text="${#numbers.formatDecimal(transaction.amount.abs(), 1, 2)}">0.00</span>
                    </div>
                    
                    <!-- Purchase description -->
                    <h2 class="card-title text-2xl justify-center mb-8" th:text="${transaction.description}">Product Name</h2>
                    
                    <!-- Current balance -->
                    <div class="text-base-content/70 mb-8 flex items-center justify-center gap-2">
                        <span class="icon-[tabler--wallet] size-4"></span>
                        <span>Available Balance: €<span th:text="${#numbers.formatDecimal(currentUser.balance, 1, 2)}">0.00</span></span>
                    </div>

                    <!-- Insufficient Funds Warning -->
                    <div th:if="${transaction.amount.abs()}>${currentUser.balance}" 
                         class="alert alert-soft alert-warning flex items-center gap-4 mb-8" role="alert">
                        <span class="icon-[tabler--alert-triangle] shrink-0 size-6"></span>
                        <p><span class="font-bold">Insufficient funds.</span> Need additional 
                            €<span th:text="${#numbers.formatDecimal(transaction.amount.abs() - currentUser.balance, 1, 2)}">0.00</span>
                        </p>
                    </div>

                    <!-- Action buttons -->
                    <div class="grid grid-rows-2 sm:grid-cols-2 sm:grid-rows-1 gap-4 w-full">
                        <!-- Pay Button -->
                        <button th:if="${transaction.amount.abs()}<=${currentUser.balance}" 
                                th:attr="onclick=|location.href='/payment/pay?tx=${transaction.id}'|"
                                class="btn btn-primary btn-xl sm:btn-lg">
                            Pay
                        </button>
                        <button th:unless="${transaction.amount.abs()}<=${currentUser.balance}" 
                                class="btn btn-primary btn-xl sm:btn-lg btn-disabled" 
                                disabled>
                            <span class="icon-[tabler--check] size-5"></span>
                            Pay
                        </button>

                        <!-- Top-Up Button -->
                        <a th:href="@{/topup(redirect=${transaction.id})}">
                            <button
                                    class="btn btn-outline btn-m sm:btn-lg">
                                <span class="icon-[tabler--plus] size-5"></span>
                                Top-Up Balance
                            </button>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
